{% extends 'base.html' %}
{% load static %}

{% block styles %}
  <link rel="stylesheet" href="{% static "stylesheets/search.css" %}">
{% endblock %}

{% block scripts %}
  <script src="{% static "scripts/search.js" %}"></script>
{% endblock %}

{% block content %}
  <button id="addBookBtn" class="btn btn-outline-success py-1 px-2 mb-4" data-toggle="modal"
          data-target="#addBookModal">
    Add Book
  </button>

  <form id="searchForm" action="/" method="post" class="mb-2">{% csrf_token %}
    <h3>Search</h3>
    <div class="form-row mb-2 filter-toggles">
      <input type="hidden" id="activeFilters" name="activeFilters" value='["title"]'>
      {% for key, values in filter_options.items %}
        <button class="btn btn-outline-primary mb-2 filter-btn" type="button" data-filter="{{ key }}" data-toggle="collapse"
                data-target="#{{ key }}Div" aria-expanded="true" aria-controls="{{ key }}Div">
          {{ values.desc }}
        </button>
      {% endfor %}
    </div>
{#  TODO: Generalize these components to allow {% for %}-ing#}
    <div class="form-row collapse" id="titleDiv">
      <div class="col-md-3 col-lg-2 mb-2">
        <label for="title" class="text-md-center mb-0">Title</label>
      </div>
      <div class="col-md-2 mb-2">
        <select name="title-match" class="form-control">
          {% for key, values in match_options.items %}
            <option value="{{ key }}">
              {{ values.desc }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-7 col-lg-8 mb-2">
        <input id="title" name="title" class="form-control" placeholder="Enter Title">
      </div>
    </div>
    <div class="form-row collapse" id="author-lastDiv">
      <div class="col-md-3 col-lg-2 mb-2">
        <label for="author-last" class="text-md-center mb-0">Author (Last)</label>
      </div>
      <div class="col-md-2 mb-2">
        <select name="author-last-match" class="form-control">
          {% for key, values in match_options.items %}
            <option value="{{ key }}">
              {{ values.desc }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-7 col-lg-8 mb-2">
        <input id="author-last" name="author-last" class="form-control" placeholder="Enter Author (Last)">
      </div>
    </div>
    <div class="form-row collapse" id="author-firstDiv">
      <div class="col-md-3 col-lg-2 mb-2">
        <label for="author-first" class="text-md-center mb-0">Author (First)</label>
      </div>
      <div class="col-md-2 mb-2">
        <select name="author-first-match" class="form-control">
          {% for key, values in match_options.items %}
            <option value="{{ key }}">
              {{ values.desc }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-7 col-lg-8 mb-2">
        <input id="author-first" name="author-first" class="form-control" placeholder="Enter Author (First)">
      </div>
    </div>
    <div class="form-row collapse" id="author-wholeDiv">
      <div class="col-md-3 col-lg-2 mb-2">
        <label for="author-whole" class="text-md-center mb-0">Author (First+Last)</label>
      </div>
      <div class="col-md-2 mb-2">
        <select name="author-whole-match" class="form-control">
          {% for key, values in match_options.items %}
            <option value="{{ key }}">
              {{ values.desc }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-7 col-lg-8 mb-2">
        <input id="author-whole" name="author-whole" class="form-control" placeholder="Enter Author (Whole)">
      </div>
    </div>
    <div id="andOrDiv" class="form-row collapse">
      <div class="col-md-3 mb-2">
        <a id="andOrBtn" class="btn btn-outline-secondary py-1 px-2 btn-nohoverfill" href="javascript:void(0);"
           onclick="toggleAndOr()">Results match ALL filters</a>
        <input type="hidden" id="andOrHidden" name="andOr" value="and">
      </div>
    </div>
    <div class="form-row d-flex flex-column maxw-max-content">
      <button id="searchBtn" class="btn btn-primary w-100 mt-4">
        <i class="fas fa-search"></i> Search
      </button>
    </div>
  </form>

  <h4 id="noResultsLabel" class="font-italic font-weight-light d-none">No results</h4>
  <table id="resultsTable" class="table d-none">
    <thead>
      <tr>
        <th scope="col">Author</th>
        <th scope="col">Title</th>
        <th scope="col" class="d-none d-sm-table-cell">Location</th>
      </tr>
    </thead>
    <tbody id="resultsBody">
    </tbody>
  </table>

  <div id="addBookModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Book</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="addBookForm" action="/add" method="post">
            <div class="form-row">
              <label for="addTitle">Title<span class="text-danger"> *</span></label>
              <input id="addTitle" class="form-control" name="title" required>
            </div>
            <div class="form-row">
              {# TODO: Rework to better support adding new authors (need something editable) #}
              <label for="addAuthor">Author</label>
              <select id="addAuthor" class="form-control" name="author" multiple>
                {% for author in authors %}
                  <option value="{{ author.id }}">{{ author.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-row">
              <label for="addCategory">Category<span class="text-danger"> *</span></label>
              <select id="addCategory" class="form-control" name="category" multiple required>
                {% for cat in categories %}
                  <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-row">
              <label for="addLocation">Location</label>
              <input id="addLocation" class="form-control" name="location">
            </div>
            <div class="form-row">
              <label for="addNotes">Notes</label>
              <textarea id="addNotes" class="form-control" name="location"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-success">Add</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
